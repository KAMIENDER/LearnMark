# ES

官方文档：https://www.elastic.co/guide/cn/elasticsearch/guide/current/intro.html

性能优化参考：https://zhuanlan.zhihu.com/p/84871325



### 性能上限

官方网文档中的描述：

- 一个分布式的实时文档存储，每个字段 可以被索引与搜索
- 一个分布式实时分析搜索引擎
- 能胜任上百个服务节点的扩展，并支持 PB 级别的结构化或者非结构化数据

es性能和硬件资源有着很大的关系



### 基础结构

es集群-》node节点-》shard分片（不同分片之间数据不同）-》主从shard（主从shard之间数据一致）



### 优化思路

* 阶段一：默认配置，部署于弹性云，与其他服务集群混用

问题：单点问题、虚拟资源超限受到影响（资源抢占问题）

解决：独占弹性云，后续迁移到高性能物理机



* 阶段二：集群单独部署到高性能物理机

采用每个节点单独部署到独立的物理机上

问题：单点问题，单个节点成为性能瓶颈

解决：建立副本，es搜索过程是先发给每个分片，分片再转发给主或从节点，进行搜索然后返回

至于shard、主从副本数量需要通过测试得到



* 阶段三：主备ES集群

es集群层面也进行主备

双写通过业务实现，同步写主集群，异步写备集群

使用zookeeper实现流量开关



* 阶段四：主备集群可以完成冷热数据分离

备集群归档机制会转移较久以前的数据

物理集群性能相同、数据量越少，ES集群的性能越高，因此备集群成为一个性能更高的热数据集群

双写策略也发生改变

