# 线程与进程

### 线程切换与进程切换

两者切换最大的区别在于：进程切换涉及到虚拟内存空间的切换而线程切换不会

* 虚拟内存是操作系统的一种抽象
* 虚拟内存作为一种资源存在，每个进程有自己的、私有的、地址连续的虚拟内存
  * 虚拟内存与实际的物理内存存在转换关系（地址空间映射），通过页表来实现，记录了虚拟内存到物理内存的映射关系
  * 页表查找通常是一个很慢的过程，通过cache的方式（TLB）进行加速
  * 进程切换之后TLB失效，因此切换后的一段时间内，进程执行的速度会下降，因此线程切换会比进程切换要快
* 进程拥有自己独立的虚拟内存地址空间，进程内线程共享进程的虚拟地址空间

进行切换的时候，其他上下文都需要进行切换

* 通用目的寄存器
* 浮点寄存器
* 程序计数器
* 用户栈
* 状态寄存器
* 内核栈
* 内核数据结构：如页表、进程表、文件表

这些上下文信息一般存储在PCB（进程控制块）、TCB（线程控制块），在不同操作系统中可能有着不一样的实现

* Linux操作系统中PCB、TCB为task_struct结构定义的数据结构

通过管理PCB、TCB的方式进行线程、进程的调度



### 线程间通信与进程间通信

